---
title: "create_bootstrap_samples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{create_bootstrap_samples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

```


```{r setup }
library(boots.lmer)
```


This vignette contains a walk-through of `boots.lmer::boots.samples` function.


The `boots.samples` function produces a list of bootstrap samples, made especially for longitudinal data. Longitudinal data formatted where multiple observations should be chosen cautiously when sampling for boostrap:

1. sampling unit should be subject. That is, if one subject is chosen in the boostrap sample, the subject's entire observations should be included. 
2. the returning subject's name should be different if they were selected more than once, to use for random effects. 

Here's the example. The below example can be found in `help(boots.samples)` page as well.

<br>
<br>

# Generate example data

Here's an example data:
```{r}
set.seed(1020)
example.subject<-c("Sarah","John","Beth","Anna","Sarah","Sarah","Chris","Blake","John","Anna")
example.dat<-data.frame("Y"=rnorm(n=length(example.subject)),
                        "X1"=rpois(n=length(example.subject), lambda = 3),
                        "X2"=rnorm(n=length(example.subject)),
                        "X3"=rbeta(n=length(example.subject), shape1 = 3, shape2 = 0.5),
                        "subjects"=example.subject)
knitr::kable(example.dat, caption = "Table 1. Example data set.")
```

The example dataset contains total of 6 subjects (Sarah, John, Beth, Anna, Chris, and Blck), with some repeating observations from few subjects.



# Creating bootstrap samples using a longitudinal data


Here's `boots.samples` output, if we use `example.dat$subjects` as our subject ID to create 4 bootstrap samples.:


```{r}
output<-boots.samples(dat = example.dat, sub.id = "subjects",B=4)

output
# knitr::kable(output,caption = "Table 2. Four boostrap samples of example.dat data sets. The sampling unit is subject, hence the number of rows of each data set is expected to be different from one another.",row.names = FALSE)
```

The output is a list of 4, each list being a data frame. Each data frame contains two columns: **index** and **no.repeat.id.** We will explain each column using the first bootstrap sample:

```{r}

output[[1]]
# knitr::kable(output[[1]],caption = "Table 2.A. The first bootstrap sample",row.names = FALSE)
```

In the first sample, total 6 subjects are chosen, but the number of rows is different from the original data set. The original data set has 10 rows, but the first bootstrap sample has 11 rows. This is because again, our sample of unit is subject, where there are different number of observations for each subject.   

The **index** column shows the row number of the original data set for each row of the bootstrap sample. For example, the first two rows belong to John, with index 2 and 9. We can get the bootstrap data using these index. 

```{r}
# example.dat[output[[1]]$index,]
```

The **index** can be used to select the right observation from the original data set. However, if we are to use the subjects as a random effect in our linear mixed effects model, the subjects has to be distinguished each time it is chosen. For example, in our first bootstrap sample, John is chosen 3 times. If we use `John` as is in the random effects, R will not be able to distinguish these 3 different `John`s. Therefore, we need to name the 3 `John`s differently. If we look at **no.repeat.id** column in Table 2.A, the different names are assigned with `__#` format, where `#` is the number of times the subject was sampled. Hence, we see that we have `John__1`, `John__2`, and `John__3` to take into account `John` as 3 different subjects.
